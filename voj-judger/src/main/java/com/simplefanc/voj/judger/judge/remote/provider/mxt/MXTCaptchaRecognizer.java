package com.simplefanc.voj.judger.judge.remote.provider.mxt;

import cn.hutool.core.img.gif.GifDecoder;

import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.List;

public class MXTCaptchaRecognizer {

    private static String[][] digitals = new String[][]{{"..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "................#.............",
                    ".............#########........", "...........#####.######.......",
                    "...........###.....####.......", "..........###.......####......",
                    ".........####.......####......", "..........##........####......",
                    "....................###.......", "...................####.......",
                    "...................###........", "..................###.........",
                    "................####..........", "...............####...........",
                    "..............####............", "............####..............",
                    "...........####...............", ".........####.................",
                    "........####..................", ".......###############........",
                    ".......##############.........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "................#.............",
                    ".............#########........", "...........#####..#####.......",
                    "..........####.....####.......", "..........###.......####......",
                    ".........#..#.......###.......", "....................###.......",
                    "...................####.......", "..................####........",
                    ".............#######..........", ".............########.........",
                    "............#.....####........", "...................####.......",
                    "...................####.......", "...................####.......",
                    ".......###.........###........", ".......####.......####........",
                    "........###......####.........", "........############..........",
                    "..........########............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..................####........", ".................#####........",
                    "................######........", "...............######.........",
                    "..............###.###.........", ".............###..###.........",
                    "............####..###.........", "............###..####.........",
                    "...........###...####.........", "..........###....###..........",
                    ".........###.....###..........", "........####.....###..........",
                    ".......####......###..........", ".......################.......",
                    ".......################.......", "................###...........",
                    "................###...........", "................###...........",
                    "...............####...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........#############......", "...........############.......",
                    "...........##.................", "..........###.................",
                    "..........###.................", "..........###.................",
                    "..........##.######...........", ".........############.........",
                    ".........#####....####........", ".........####......###........",
                    "..........##.......####.......", "...................####.......",
                    "...................####.......", "...................###........",
                    "........##.........###........", ".......####.......###.........",
                    "........####.....####.........", "........############..........",
                    "..........########............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............########........", "............###########.......",
                    "...........####.....####......", "..........####......####......",
                    "..........###.................", ".........###..................",
                    ".........###....##............", "........####.########.........",
                    "........###.###..#####........", "........#####......###........",
                    "........####.......####.......", "........####.......####.......",
                    "........###........####.......", "........###........###........",
                    "........###........###........", "........###.......####........",
                    ".........###.....####.........", ".........###########..........",
                    "..........########............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..........##############......", "..........##############......",
                    "....................###.......", "...................###........",
                    "..................###.........", ".................###..........",
                    "................####..........", "................###...........",
                    "...............###............", "..............####............",
                    "..............###.............", ".............####.............",
                    ".............###..............", "............####..............",
                    "............###...............", "...........####...............",
                    "...........####...............", "...........###................",
                    "...........###................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "................#.............",
                    ".............#########........", "...........#####..#####.......",
                    "..........####......####......", "..........###.......####......",
                    ".........####.......####......", ".........####.......###.......",
                    "..........####.....####.......", "..........#####..#####........",
                    "...........#########..........", "...........#########..........",
                    ".........#####..######........", "........####......####........",
                    ".......####........####.......", ".......###.........####.......",
                    ".......###.........####.......", ".......###.........###........",
                    ".......####.......####........", "........############..........",
                    "..........#########...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "...............#..............",
                    ".............########.........", "...........#####.#####........",
                    "..........####.....####.......", ".........####.......###.......",
                    ".........###........###.......", ".........###........####......",
                    ".........###........####......", "........####.......####.......",
                    ".........###.......####.......", ".........####.....#####.......",
                    "..........#########.###.......", "...........#######.####.......",
                    "...................###........", "...................###........",
                    ".........#........###.........", ".......####......####.........",
                    "........###.....####..........", "........###########...........",
                    ".........########.............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},};

    private static String[][] upper = new String[][]{{"..............................",
            "..............................", "..............................", "...............####...........",
            "..............#####...........", "..............#####...........", ".............######...........",
            ".............######...........", "............###.####..........", "............###.####..........",
            "...........###..####..........", "...........###..####..........", "..........###....###..........",
            "..........###....###..........", ".........###.....###..........", ".........############.........",
            "........###......####.........", "........##.......####.........", ".......###.......####.........",
            ".......###........###.........", "......###.........###.........", ".....####.........####........",
            "..............................", "..............................", "..............................",
            "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........###########........", "..........#############.......",
                    "..........####......####......", "..........###........###......",
                    "..........###........###......", "..........###.......####......",
                    ".........####.......###.......", ".........####......###........",
                    ".........############.........", ".........############.........",
                    ".........###.......###........", ".........###.......####.......",
                    "........####........###.......", "........####........###.......",
                    "........###........####.......", "........###........###........",
                    "........###......#####........", "........#############.........",
                    "........###########...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", ".................#............",
                    ".............#########........", "............###########.......",
                    "...........####.....####......", "..........####......####......",
                    "..........###........###......", ".........####........###......",
                    ".........###..................", "........####..................",
                    "........####..................", "........###...................",
                    "........###...................", "........###...................",
                    "........###.........#.........", "........###.........###.......",
                    "........####.......###........", "........####......####........",
                    ".........####....####.........", "..........##########..........",
                    "...........#######............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........###########........", "..........#############.......",
                    "..........####......####......", "..........###........####.....",
                    "..........###........####.....", "..........###.........###.....",
                    "..........###.........###.....", ".........####.........###.....",
                    ".........####.........###.....", ".........###..........###.....",
                    ".........###.........####.....", ".........###.........####.....",
                    ".........###.........###......", "........####........####......",
                    "........####.......####.......", "........###.......####........",
                    "........###......####.........", "........############..........",
                    ".......###########............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........#############......", "..........##############......",
                    "..........####................", "..........###.................",
                    "..........###.................", "..........###.................",
                    "..........###.................", ".........####.................",
                    ".........###########..........", ".........###########..........",
                    ".........###..................", ".........###..................",
                    ".........###..................", "........####..................",
                    "........####..................", "........###...................",
                    "........###...................", "........#############.........",
                    ".......##############.........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........############.......", "..........#############.......",
                    "..........####................", "..........###.................",
                    "..........###.................", "..........###.................",
                    ".........####.................", ".........####.................",
                    ".........###########..........", ".........###########..........",
                    ".........###..................", ".........###..................",
                    "........####..................", "........####..................",
                    "........###...................", "........###...................",
                    "........###...................", "........###...................",
                    ".......####...................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", ".................#............",
                    "..............#########.......", "............############......",
                    "...........####.....####......", "...........###.......####.....",
                    "..........###.........###.....", ".........####.........#.......",
                    ".........###..................", "........####..................",
                    "........####..................", "........####....#########.....",
                    "........###.....########......", "........###..........###......",
                    "........###.........####......", "........####........####......",
                    "........####........####......", "........####.......####.......",
                    ".........####.....#####.......", "..........#############.......",
                    "...........########.###.......", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........###........###.....", "..........####........###.....",
                    "..........####.......####.....", "..........###........####.....",
                    "..........###........####.....", "..........###........###......",
                    ".........####........###......", ".........####........###......",
                    ".........###############......", ".........###############......",
                    ".........###........###.......", ".........###........###.......",
                    "........####........###.......", "........####........###.......",
                    "........###........####.......", "........###........####.......",
                    "........###........###........", "........###........###........",
                    ".......####........###........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........###.......####.....", "..........####......####......",
                    "..........####.....####.......", "..........####....####........",
                    "..........###....####.........", "..........###...####..........",
                    "..........###..####...........", ".........####..####...........",
                    ".........####.######..........", ".........###.#######..........",
                    ".........######..####.........", ".........#####...####.........",
                    ".........####.....###.........", "........####......####........",
                    "........####......####........", "........###........###........",
                    "........###........####.......", "........###........####.......",
                    ".......####.........####......", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..........#####..........#####", "..........######.........#####",
                    "..........######........######", "..........######........######",
                    "..........##.###.......##.###.", "..........##.###.......##.###.",
                    ".........###.####.....##..###.", ".........###.####....###.####.",
                    ".........###..###....##..####.", ".........##...###...###..###..",
                    ".........##...###...##...###..", ".........##...####.###...###..",
                    "........###...####.##....###..", "........###....######...####..",
                    "........###....#####....####..", "........##.....#####....###...",
                    "........##.....####.....###...", "........##.....####.....###...",
                    ".......###.....###.....####...", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........####........###....", "..........#####.......###.....",
                    "..........######......###.....", "..........######......###.....",
                    "..........#######.....###.....", "..........###.###.....###.....",
                    ".........###..###.....###.....", ".........###..####...###......",
                    ".........###...###...###......", ".........###...####..###......",
                    ".........###....###..###......", ".........###....###..###......",
                    "........###.....####.###......", "........###......######.......",
                    "........###......######.......", "........###.......#####.......",
                    "........###.......#####.......", "........###.......#####.......",
                    ".......###.........####.......", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..........###########.........", "..........############........",
                    "..........###......####.......", "..........###.......###.......",
                    ".........####.......###.......", ".........####.......###.......",
                    ".........###.......####.......", ".........###.......####.......",
                    ".........###......####........", "........#############.........",
                    "........###########...........", "........####..................",
                    "........###...................", "........###...................",
                    "........###...................", ".......####...................",
                    ".......####...................", ".......###....................",
                    ".......###....................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", ".................#............",
                    "..............########........", "............###########.......",
                    "...........####.....####......", "..........####.......###......",
                    "..........###........####.....", ".........####........####.....",
                    ".........###.........####.....", "........####.........####.....",
                    "........####.........####.....", "........###..........####.....",
                    "........###..........####.....", "........###..........###......",
                    "........###.........####......", "........###.........####......",
                    "........###........####.......", "........####......####........",
                    ".........####....####.........", ".........###########..........",
                    "...........#######............", ".............#####............",
                    "..............###.............", "..............#######.........",
                    "...............######.........", ".................##..........."},
            {"..............................", "..............................", "..............................",
                    "...........###########........", "..........##############......",
                    "..........####......####......", "..........###........###......",
                    "..........###........###......", "..........###........###......",
                    ".........####.......####......", ".........####.......###.......",
                    ".........####.....#####.......", ".........############.........",
                    ".........###########..........", ".........###.....###..........",
                    "........####.....###..........", "........####.....####.........",
                    "........###......####.........", "........###.......###.........",
                    "........###.......###.........", "........###.......####........",
                    ".......####.......####........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "................#.............",
                    ".............#########........", "...........#####..#####.......",
                    "...........###......####......", "..........###.......####......",
                    "..........###........##.......", "..........###.................",
                    "..........####................", "..........######..............",
                    "...........#########..........", ".............#########........",
                    "................#######.......", "...................####.......",
                    "...................####.......", ".........#..........###.......",
                    ".......####........####.......", "........###........###........",
                    "........####......####........", ".........############.........",
                    "..........#########...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    ".........##############.......", "........###############.......",
                    "..............###.............", ".............####.............",
                    ".............####.............", ".............####.............",
                    ".............###..............", ".............###..............",
                    ".............###..............", "............####..............",
                    "............####..............", "............###...............",
                    "............###...............", "............###...............",
                    "............###...............", "...........####...............",
                    "...........####...............", "...........###................",
                    "...........###................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...........###........###.....", "..........####........###.....",
                    "..........####.......###......", "..........###........###......",
                    "..........###........###......", "..........###........###......",
                    ".........####........###......", ".........####........###......",
                    ".........####.......###.......", ".........###........###.......",
                    ".........###........###.......", ".........###........###.......",
                    "........####........###.......", "........####.......###........",
                    "........####.......###........", "........####......####........",
                    ".........####....####.........", ".........###########..........",
                    "..........########............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    ".........###.........####.....", ".........###.........###......",
                    ".........####.......####......", ".........####.......###.......",
                    ".........####......####.......", "..........###......###........",
                    "..........###.....###.........", "..........###.....###.........",
                    "..........####...###..........", "..........####...###..........",
                    "..........####..###...........", "...........###..###...........",
                    "...........###.###............", "...........###.###............",
                    "...........######.............", "...........######.............",
                    "...........#####..............", "............####..............",
                    "............###...............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    ".........###.......###.......#", ".........###......####......##",
                    ".........###......####......##", ".........###......####......##",
                    ".........###.....######....###", ".........####....######....###",
                    ".........####....######....##.", ".........####...#######...###.",
                    ".........####...##..###...##..", ".........####..###..###...##..",
                    "..........###..##...###..###..", "..........###..##...###..##...",
                    "..........###.##....###..##...", "..........###.##....###.##....",
                    "..........###.##....######....", "..........#####.....######....",
                    "..........#####.....#####.....", "..........####.......####.....",
                    "..........####.......###......", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    ".........####.......####......", "..........####.....###........",
                    "..........####....####........", "...........####...###.........",
                    "...........####..###..........", "............###.###...........",
                    "............######............", ".............#####............",
                    ".............####.............", ".............####.............",
                    "............######............", "...........#######............",
                    "..........####.###............", "..........###..####...........",
                    ".........###...####...........", "........###.....####..........",
                    ".......###......####..........", "......####.......###..........",
                    ".....####........####.........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    ".........####........####.....", ".........####.......####......",
                    "..........####......###.......", "..........####.....###........",
                    "...........###....###.........", "...........####..####.........",
                    "...........####..###..........", "............#######...........",
                    "............######............", ".............#####............",
                    ".............####.............", ".............###..............",
                    ".............###..............", ".............###..............",
                    ".............###..............", "............####..............",
                    "............####..............", "............###...............",
                    "............###...............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    ".........##############.......", ".........##############.......",
                    "..................####........", ".................####.........",
                    ".................###..........", "................###...........",
                    "...............###............", "..............####............",
                    ".............####.............", "............####..............",
                    "...........####...............", "...........###................",
                    "..........###.................", ".........###..................",
                    "........####..................", ".......####...................",
                    "......####....................", "......##############..........",
                    ".....###############..........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."}};

    private static String[][] lower = new String[][]{{"..............................",
            "..............................", "..............................", "..............................",
            "..............................", "..............................", "..............................",
            "..............####............", "...........#########..........", "..........####...####.........",
            ".........###......###.........", "..........##......###.........", "..................###.........",
            "............#########.........", "..........###########.........", "........####......###.........",
            "........###......####.........", ".......####......###..........", ".......####.....####..........",
            ".......####....#####..........", "........####.#######..........", ".........#######.###..........",
            "..............................", "..............................", "..............................",
            "..............................", "..............................",},
            {"..............................", "..............................", "..............................",
                    "..........###.................", "..........###.................",
                    "..........###.................", ".........####.................",
                    ".........###...##.............", ".........###.#######..........",
                    ".........#####..#####.........", ".........####....####.........",
                    ".........###......###.........", "........####......###.........",
                    "........###.......###.........", "........###.......###.........",
                    "........###.......###.........", "........###......####.........",
                    "........###......###..........", ".......####.....####..........",
                    ".......#####....###...........", ".......##.########............",
                    ".......##.#######.............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    ".............###..............", "...........########...........",
                    "..........###...####..........", ".........###.....###..........",
                    "........####.....###..........", "........###......##...........",
                    "........###...................", ".......####...................",
                    ".......###....................", ".......###....................",
                    ".......###......###...........", ".......####.....###...........",
                    "........###....###............", "........#########.............",
                    ".........#######..............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "...................####.......", "...................###........",
                    "...................###........", "...................###........",
                    ".............####..###........", "...........###########........",
                    "..........###...#####.........", ".........###.....####.........",
                    "........####......###.........", "........###.......###.........",
                    "........###.......###.........", ".......####......####.........",
                    ".......####......###..........", ".......####......###..........",
                    ".......####......###..........", ".......####.....####..........",
                    "........###....#####..........", "........########.##...........",
                    ".........######.###...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............###.............", "...........########...........",
                    "..........####...###..........", ".........####.....###.........",
                    "........####......###.........", "........###.......###.........",
                    "........#############.........", ".......##############.........",
                    ".......####...................", ".......####...................",
                    ".......####.....#.............", ".......####......###..........",
                    "........###.....###...........", "........##########............",
                    ".........########.............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "...............#..............",
                    "............#######...........", "...........####..#............",
                    "...........###................", "...........###................",
                    "..........####................", "........#########.............",
                    ".......#########..............", "..........###.................",
                    "..........###.................", ".........####.................",
                    ".........###..................", ".........###..................",
                    ".........###..................", ".........###..................",
                    ".........###..................", "........####..................",
                    "........###...................", "........###...................",
                    "........###...................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..................####........",
                    ".............#######..........", "..........#########...........",
                    ".........####..####...........", ".........###....####..........",
                    "........###......###..........", "........###.....####..........",
                    "........###.....###...........", "........####...####...........",
                    ".........#########............", "........########..............",
                    ".......###....................", ".......###....................",
                    ".......####...................", ".......############...........",
                    "......##############..........", ".....####.......####..........",
                    ".....###.........###..........", ".....###........###...........",
                    ".....######...#####...........", "......###########............."},
            {"..............................", "..............................", "..............................",
                    "..........####................", "..........###.................",
                    "..........###.................", "..........###.................",
                    "..........###..###............", ".........###########..........",
                    ".........###.##..####.........", ".........####....####.........",
                    ".........####.....###.........", ".........###......###.........",
                    "........####.....####.........", "........###......###..........",
                    "........###......###..........", "........###......###..........",
                    "........###......###..........", "........###......###..........",
                    ".......####.....####..........", ".......###......###...........",
                    ".......###......###...........", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",},
            {"..............................", "..............................", "..............................",
                    "..........####................", "..........####................",
                    "..............................", "..............................",
                    "..............................", "..........###.................",
                    ".........####.................", ".........###..................",
                    ".........###..................", ".........###..................",
                    ".........###..................", ".........###..................",
                    "........####..................", "........###...................",
                    "........###...................", "........###...................",
                    "........###...................", "........###...................",
                    ".......####...................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..........####................", "..........###.................",
                    "..............................", "..............................",
                    "..............................", ".........###..................",
                    ".........###..................", ".........###..................",
                    ".........###..................", "........####..................",
                    "........###...................", "........###...................",
                    "........###...................", "........###...................",
                    "........###...................", ".......####...................",
                    ".......###....................", ".......###....................",
                    ".......###....................", ".......###....................",
                    "......####....................", "......###.....................",
                    "..#######.....................", "..#####......................."},
            {"..............................", "..............................", "..............................",
                    "..........####................", "..........###.................",
                    "..........###.................", "..........###.................",
                    "..........###.................", ".........####.....####........",
                    ".........###.....###..........", ".........###...####...........",
                    ".........###..####............", ".........###.####.............",
                    ".........########.............", "........#########.............",
                    "........#####.###.............", "........####...###............",
                    "........###....###............", "........###....###............",
                    "........###.....###...........", ".......####.....###...........",
                    ".......###......####..........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "...............##......###....", ".........###.######..#######..",
                    ".........#####..#######..####.", ".........####....#####...####.",
                    ".........###.....####.....###.", ".........###.....###......###.",
                    "........####.....###.....####.", "........###......###.....###..",
                    "........###......###.....###..", "........###.....####.....###..",
                    "........###.....###......###..", "........###.....###.....####..",
                    ".......####.....###.....####..", ".......###......###.....###...",
                    ".......###.....####.....###...", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "...............###............", ".........###.#######..........",
                    ".........######..####.........", ".........####.....###.........",
                    ".........####.....###.........", ".........###......###.........",
                    "........####.....####.........", "........###......####.........",
                    "........###......###..........", "........###......###..........",
                    "........###......###..........", "........###......###..........",
                    ".......####.....####..........", ".......###......###...........",
                    ".......###......###...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "...............###............", "..........##########..........",
                    ".........###.##.#####.........", ".........#####....###.........",
                    ".........####.....####........", ".........###......####........",
                    ".........###......####........", "........####......####........",
                    "........####......###.........", "........###.......###.........",
                    "........###......####.........", "........####.....###..........",
                    "........####....####..........", ".......############...........",
                    ".......###.######.............", ".......###....................",
                    ".......###....................", ".......###....................",
                    ".......###....................", "......####...................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    ".............###..............", "...........#######.###........",
                    "..........####..#####.........", ".........####....####.........",
                    "........####.....####.........", "........###.......###.........",
                    "........###......####.........", ".......####......####.........",
                    ".......####......###..........", ".......####......###..........",
                    ".......####.....####..........", ".......####.....####..........",
                    "........###....#####..........", "........###########...........",
                    ".........######.###...........", "................###...........",
                    "................###...........", "................###...........",
                    "...............####...........", "...............###............"},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "...............###............", ".........###.####.............",
                    ".........########.............", ".........#####................",
                    ".........####.................", ".........###..................",
                    ".........###..................", "........####..................",
                    "........###...................", "........###...................",
                    "........###...................", "........###...................",
                    ".......####...................", ".......###....................",
                    ".......###....................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    ".............###..............", "...........########...........",
                    ".........####...####..........", ".........###.....####.........",
                    ".........###.....#............", "........####..................",
                    ".........######...............", ".........##########...........",
                    "............########..........", "................####..........",
                    ".................###..........", ".......###.......###..........",
                    ".......####.....###...........", "........###########...........",
                    ".........########.............", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",},
            {"..............................", "..............................", "..............................",
                    "..............................", "...........###................",
                    "..........####................", "..........###.................",
                    "..........###.................", ".......#########..............",
                    "..........###.................", "..........###.................",
                    ".........####.................", ".........###..................",
                    ".........###..................", ".........###..................",
                    ".........###..................", ".........###..................",
                    "........####..................", "........###...................",
                    "........####..................", ".........###.##...............",
                    ".........######...............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".........####.....####........",
                    ".........###......###.........", ".........###......###.........",
                    ".........###......###.........", ".........###......###.........",
                    "........####.....####.........", "........###......###..........",
                    "........###......###..........", "........###......###..........",
                    "........###.....####..........", "........###.....####..........",
                    "........###....#####..........", "........###########...........",
                    ".........######.###...........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "........###.......###.........",
                    "........###......###..........", "........###......##...........",
                    "........####....###...........", "........####...###............",
                    ".........###...###............", ".........###..###.............",
                    ".........###..###.............", ".........#######..............",
                    ".........#######..............", "..........#####...............",
                    "..........#####...............", "..........####................",
                    "..........####................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "........###.....###.....###...",
                    "........###....####....###....", "........###....####....##.....",
                    "........###...#####...###.....", "........###...#####...##......",
                    "........###..######..###......", "........####.######..###......",
                    ".........######.###.###.......", ".........######..######.......",
                    ".........#####...#####........", ".........#####...#####........",
                    ".........####....####.........", ".........####....####.........",
                    ".........###.....###..........", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "........####....####..........",
                    ".........###...####...........", ".........####..###............",
                    "..........###.###.............", "..........######..............",
                    "...........####...............", "...........####...............",
                    "...........####...............", "..........######..............",
                    ".........###.###..............", "........###..####.............",
                    ".......###....###.............", "......####....####............",
                    ".....####.....####............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "........###......###..........",
                    "........###......##...........", "........###.....###...........",
                    "........####....##............", "........####...###............",
                    ".........###..###.............", ".........###..###.............",
                    ".........###.###..............", ".........###.###..............",
                    ".........######...............", ".........######...............",
                    "..........####................", "..........####................",
                    "..........###.................", "..........###.................",
                    ".........###..................", "........###...................",
                    ".....######...................", ".....####....................."},
            {"..............................", "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", "..............................",
                    "..............................", ".........###########..........",
                    ".........##########...........", "...............###............",
                    "..............###.............", ".............###..............",
                    "............####..............", "...........####...............",
                    "..........####................", ".........####.................",
                    ".........###..................", "........###...................",
                    ".......###....................", "......############............",
                    "......###########.............", "..............................",
                    "..............................", "..............................",
                    "..............................", ".............................."}

    };

    /**
     * @param colorInt 像素点的RGB值
     * @return
     */
    private static boolean isBlack(int colorInt) {
        Color color = new Color(colorInt);
        if (color.getRed() + color.getGreen() + color.getBlue() <= 500) {
            return true;
        }
        return false;
    }

    /**
     * @param image 需要打印的图像
     * @throws IOException
     */
    private static void printImage(BufferedImage image) {
        int h = image.getHeight();
        int w = image.getWidth();

        // 矩阵打印
        for (int y = 0; y < h; y++) {
            System.out.printf("\"");
            for (int x = 0; x < w; x++) {
                if (isBlack(image.getRGB(x, y))) {
                    System.out.print("#");
                } else {
                    System.out.print(".");
                }
            }
            System.out.printf("%s", y == h - 1 ? "\"" : "\",");
            System.out.println();
        }
    }

    /**
     * @param file 需要被分割的gif文件
     * @throws Exception
     */
    private static List<BufferedImage> splitGif(File file) throws IOException {
        InputStream in = new FileInputStream(file);
        GifDecoder d = new GifDecoder();
        d.read(in);
        int num = d.getFrameCount();
        List<BufferedImage> subImgs = new ArrayList<>();
        for (int i = 0; i < num; i++) {
            // 分割每一帧图片，进行识别
            // 3 2 1 0
            BufferedImage frame = d.getFrame(num - i - 1);
            // printImage(frame);
            subImgs.add(frame.getSubimage(7 + i * 36, 5, 30, 27));
        }
        in.close();
        return subImgs;
    }

    /**
     * @param image 待识别的符号图片
     * @return
     */
    private static char recognizeSymbol(BufferedImage image) {
        int h = image.getHeight();
        int w = image.getWidth();

        int minDiff = 999999;
        char symAns = 0;
        // 对于某个给定数值
        for (int i = 0; i < 10; i++) {
            int curDiff = 0;
            for (int y = 0; y < h; y++) {
                for (int x = 0; x < w; x++) {
                    boolean pixel1 = digitals[i][y].charAt(x) == '#';
                    boolean pixel2 = isBlack(image.getRGB(x, y));
                    if (pixel1 != pixel2) {
                        ++curDiff;
                    }
                }
            }
            if (curDiff < minDiff) {
                minDiff = curDiff;
                symAns = (char) ('0' + i);
            }
            if (minDiff < 5) {
                return symAns;
            }
        }

        // 对于某个给定大写字母
        for (int i = 0; i < 26; i++) {
            int curDiff = 0;
            for (int y = 0; y < h; y++) {
                for (int x = 0; x < w; x++) {
                    boolean pixel1 = upper[i][y].charAt(x) == '#';
                    boolean pixel2 = isBlack(image.getRGB(x, y));
                    if (pixel1 != pixel2) {
                        ++curDiff;
                    }
                }
            }
            if (curDiff < minDiff) {
                minDiff = curDiff;
                symAns = (char) ('A' + i);
            }
            if (minDiff < 5) {
                return symAns;
            }
        }

        // 对于某个给定小写字母
        for (int i = 0; i < 26; i++) {
            int curDiff = 0;
            for (int y = 0; y < h; y++) {
                for (int x = 0; x < w; x++) {
                    boolean pixel1 = lower[i][y].charAt(x) == '#';
                    boolean pixel2 = isBlack(image.getRGB(x, y));
                    if (pixel1 != pixel2) {
                        ++curDiff;
                    }
                }
            }
            if (curDiff < minDiff) {
                minDiff = curDiff;
                symAns = (char) ('a' + i);
            }
            if (minDiff < 5) {
                return symAns;
            }
        }

        return symAns;
    }

    /**
     * @param file 待识别的验证码
     * @return
     */
    public static String recognize(File file) throws IOException {
        StringBuilder ans = new StringBuilder();

        List<BufferedImage> subImgs = splitGif(file);
        for (BufferedImage subImg : subImgs) {
            ans.append(recognizeSymbol(subImg));
        }
        return ans.toString();
    }

}
